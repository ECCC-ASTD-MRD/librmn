!copyright (C) 2007  MSC-RPN COMM  %%%MEC%%%
!**s/r 
!APIBEGIN
program wb_test4
  implicit none
!APIEND
!
!object
!  test fn for the whiteboard multi and its fortran interface
!author
!  Stephane Chamberland, 2007-12
!revision
!  v0_00 -       - initial version, 
!
!implicits
#include "rmnlib.hf"
!externals
!** end of rpn-doc sections
  type(whiteboard) :: wb1,wb2,wb3


  integer,parameter :: NMAXITEM = 9
  integer :: val,val2,istat,i,nkeys
  character(len=WB_MAXNAMELENGTH) :: key,keys(999)
  character(len=7),parameter :: OK='OK',FAIL='FAILED'
  character(len=WB_MAXSTRINGLENGTH) :: fnname,mystr,mystr2,mystrresult,package,myfile,mysect
  character(len=1024) :: mystrlong
  character(len=WB_MAXSTRINGLENGTH),dimension(NMAXITEM) :: mystra,mystra2,mystrresulta
  integer,dimension(NMAXITEM) :: vala,vala2
  logical :: flag
  

  integer, external :: f_wb_get
  !---------------------------------------------------------------------

  !put some values in wb_global
  print *,'Put Values in WB global'
  istat = wb_put('global',0)

  !put some values in wb_local1 [same name and other names]
  print *,'Create WB tmp 1'
  istat = wb_new(wb1)
  print *,'Put Values in WB tmp 1'
  istat = wb_put('global',1,wb=wb1)
  istat = wb_put('local',11,wb=wb1)
  istat = wb_put('local1',12,wb=wb1)

  !put some values in wb_local2 [same name and other names]
  print *,'Create WB tmp 1'
  istat = wb_new(wb2)
  print *,'Put Values in WB tmp 2'
  istat = wb_put('global',2,wb=wb2)
  istat = wb_put('local',21,wb=wb2)
  istat = wb_put('local2',22,wb=wb2)

  print *,''

  !pass wb_tmp1 to s/r... print values of tmp and global wb
  print *,'>>> Print WB tmp 1'
  call printit(wb1)
  !pass wb_tmp2 to s/r... print values of tmp and global wb
  print *,'>>> Print WB tmp 2'
  call printit(wb2)

  !free wb_tmp1
  print *,''
  print *,'Free WB tmp 1'
  print *,''
  istat = wb_free(wb1)
  !try to put values in wb_tmp1
  print *,'Try to Put Values in deleted WB tmp 1'
  istat = wb_put('global',1,wb=wb1)

  !pass wb_tmp1 to s/r... print values of tmp and global wb
  print *,'>>> Print WB tmp 1'
  call printit(wb1)
  !pass wb_tmp2 to s/r... print values of tmp and global wb
  print *,'>>> Print WB tmp 2'
  call printit(wb2)

  !put some values in wb_local3 [same name and other names]
  print *,''
  print *,'Create WB tmp 3'
  istat = wb_new(wb3)
  print *,'Put Values in WB tmp 3'
  istat = wb_put('global',3,wb=wb3)
  istat = wb_put('local',31,wb=wb3)
  istat = wb_put('local3',32,wb=wb3)
  print *,''

  !pass wb_tmp1 to s/r... print values of tmp and global wb
  print *,'>>> Print WB tmp 1'
  call printit(wb1)
  !pass wb_tmp2 to s/r... print values of tmp and global wb
  print *,'>>> Print WB tmp 2'
  call printit(wb2)
  !pass wb_tmp3 to s/r... print values of tmp and global wb
  print *,'>>> Print WB tmp 3'
  call printit(wb3)

contains
  subroutine printit(wb)
    implicit none
    type(whiteboard) :: wb
    !----------
    istat = wb_keys(keys,nkeys,'')
    print *,'Print keys for global WB: ',nkeys
    do i = 1,nkeys
       istat = wb_get(keys(i),val)
       print *,keys(i),' = ',val
    enddo

    istat = wb_keys(keys,nkeys,'',wb=wb)
    print *,'Print  keys for local WB: ',nkeys
    do i = 1,nkeys
       istat = wb_get(keys(i),val,wb=wb)
       print *,keys(i),' = ',val
    enddo
  end subroutine printit


end program wb_test4
